<html>
  <head>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
      crossorigin="anonymous"
    />

    <style>
      .chart_vert {
        display: flex;
        justify-content: center;
        flex-direction: column;
      }
    </style>
  </head>

  <body>
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js"
      integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js"
      integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <div>
      <h3>
        <center>Pie chart showcasing the share of donations to parties</center>
      </h3>
    </div>
    <div class="chart_vert">
      <div>
        <canvas id="pie_chart"></canvas>
      </div>
      <div>
        <center>
          <button id="pie_chart_download" class="btn btn-success">
            Download
          </button>
        </center>
      </div>
    </div>

    <script>
      document.getElementById("pie_chart_download").addEventListener("click", (e)=>{
            download("pie_chart");
      });

          const labels = [];
          const Vals = [];
          //25 color array chosen for maximum contrast
          const colors = ['#8a00d4', '#d527b7', '#f782c2', '#f9c46b', '#e3e3e3', '#e74645', '#fb7756', '#facd60', '#fdfa66', '#1ac0c6','#454d66', '#309975', '#58b368', '#dad873', '#efeeb4','#272643', '#ffffff', '#e3f6f5', '#bae8e8', '#2c698d','#361d32', '#543c52', '#f55951', '#edd2cb', '#f1e8e6'];
          iter = {{result|tojson}};
        //   function generaterandomcolor()
        //   {
        //     let hex = ["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];
        //     let res = "#";
        //     for (let i = 0; i < 6 ; i++)
        //     {
        //         res += hex[Math.floor(Math.random()*16)];
        //     }
        //     return res
        //   }
          for (let i = 0; i < iter.length ; i ++)
          {
            labels.push(iter[i][0]);
          }
          for (let i = 0; i < iter.length ; i ++)
          {
            Vals.push(iter[i][1]);
          }
          new Chart(
            "pie_chart",

            {
              type: "pie",
              data: {
                labels: labels,
                datasets: [
                  {

                    data: Vals,
                    hoverOffset: 5,
                    backgroundColor : colors,
                  },
                ],
              },
            }
          );


      function download(name)
        {
            const imagelink = document.createElement("a");
            const canvas = document.getElementById(name);
            console.log(canvas);
            imagelink.download = name + ".png";
            imagelink.href = canvas.toDataURL('image/png', 1);
            imagelink.click();
        }
    </script>
  </body>
</html>
